<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>WebGL Project Home</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <style>
      html, body {
        margin: 0;
        padding: 0;
        height: 100%;
        width: 100%;
      }
      #unityButton {
        background-color: blue;
        color: white;
        padding: 10px 20px;
        font-size: 16px;
        border: none;
        cursor: pointer;
        margin: 20px;
      }
      iframe {
        border: none;
        width: 100%;
        height: 100%;
      }
      #responseDisplay {
        font-size: 18px;
        margin-top: 20px;
      }
    </style>
  </head>
  <body>

    <button id="unityButton" onclick="sendUnityMessage()">Send JSON Data</button>
    <div id="responseDisplay">Waiting for Unity response...</div>

    <iframe id="unityIframe" src="https://green-ground-0b5009103.6.azurestaticapps.net/"></iframe>
<script>

  function sendUnityMessage() {
    const iframe = document.getElementById("unityIframe");

    // Your full JSON data
    const jsonData = {
    "Diagram": {
        "Mode": {
            "ShowShadow": true,
            "ShowComponents": true,
            "ShowHarnesses": false
        },
        "Components": [
            {
                "Code": "ANODE_B1",
                "Connectors": [
                    {
                        "Code": "X1",
                        "PartNumber": "1-1418883-1",
                        "Selected": false
                    }
                ],
                "Selected": true
            }
        ],
        "Harnesses": null
    },
    "ConnectorShell": { 
        "PartNumber": ""
    }
}
;

    // The message structure expected by index.html
    const messageToIndex = {
        type: "UPDATE_PARAMETERS",     // index listens for this
        data: jsonData                 // payload sent to Unity
    };

    console.log("Sending message to iframe/index:", messageToIndex);

    // Post message to index.html inside iframe
    iframe.contentWindow.postMessage(messageToIndex, "*");
}

  // remove above code- for testing only.
function receiveDataFromUnity(jsonObj) {
    const display = document.getElementById("responseDisplay");

    display.innerHTML = `
        Component Code: ${jsonObj.ComponentCode}
    `;

    console.log("Received from Unity to home html:", jsonObj);
}

window.addEventListener('message', function(event) {
    const message = event.data;
 
    if (message.type === 'UnityReady') {
        console.log("Unity is ready to start in ASPU:", message);
    }
});

//ASPU html script

// Listen for messages from Unity
window.addEventListener('message', function(event) {
    const message = event.data;

    if (message.type === 'UnitySelectedComponentData') {
        console.log("Received data from Unity to home:", message.data);
        receiveDataFromUnity(message.data);  // âœ” Use object directly
    }
});
</script>



    <footer>
      <p>&copy; 2024 WebGL Project by Sebuloan</p>
    </footer>

  </body>
</html>
